<UserControl x:Class="PersonalFinance.Ui.Shared.Controls.HexColorPicker"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:PersonalFinance.Ui.Shared.Converters"
             xmlns:controls="clr-namespace:PersonalFinance.Ui.Shared.Controls">
    <UserControl.Resources>
        <converters:ColorHexEqualsConverter x:Key="ColorHexEqualsConverter" />
        <Style x:Key="HexColorToggleStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="28" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <Polygon x:Name="Hexagon"
                                     Points="14,0 28,7 28,21 14,28 0,21 0,7"
                                     Fill="{TemplateBinding Background}"
                                     Stroke="{DynamicResource CardBorderBrush}"
                                     StrokeThickness="1" />
                            <Polygon x:Name="SelectionRing"
                                     Points="14,0 28,7 28,21 14,28 0,21 0,7"
                                     Fill="Transparent"
                                     Stroke="{DynamicResource TextFillColorPrimaryBrush}"
                                     StrokeThickness="0" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Hexagon" Property="Stroke" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="SelectionRing" Property="StrokeThickness" Value="2" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <ui:Card Padding="12" BorderThickness="1">
        <StackPanel>
            <ItemsControl ItemsSource="{Binding Palette, RelativeSource={RelativeSource AncestorType=UserControl}}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <controls:HexagonWrapPanel ItemWidth="28" ItemHeight="28" HorizontalSpacing="6" VerticalSpacing="2" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <ToggleButton Style="{StaticResource HexColorToggleStyle}"
                                      Background="{Binding Converter={StaticResource ColorHexToBrushConverter}}"
                                      Command="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=SelectColorCommand}"
                                      CommandParameter="{Binding}">
                            <ToggleButton.IsChecked>
                                <MultiBinding Converter="{StaticResource ColorHexEqualsConverter}">
                                    <Binding RelativeSource="{RelativeSource AncestorType=UserControl}" Path="SelectedColorHex" />
                                    <Binding />
                                </MultiBinding>
                            </ToggleButton.IsChecked>
                        </ToggleButton>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0" VerticalAlignment="Center">
                <Rectangle Width="18" Height="18" RadiusX="4" RadiusY="4"
                           Fill="{Binding SelectedColorHex, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource ColorHexToBrushConverter}}" />
                <TextBlock Margin="8,0,0,0"
                           Text="{Binding SelectedColorHex, RelativeSource={RelativeSource AncestorType=UserControl}}"
                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
            </StackPanel>
        </StackPanel>
    </ui:Card>
</UserControl>
